{"version":3,"sources":["../src/echarts_ctrl.js"],"names":["MetricsPanelCtrl","moment","_","$","panelDefaults","remarkable","content","mode","TextPanelCtrl","$scope","$injector","templateSrv","$sce","defaults","panel","events","on","onInitEditMode","bind","onDataReceived","addEditorTab","dataList","data","HandlingText","render","type","describe","replace","updateContent","System","import","then","Remarkable","$apply","html","trustAsHtml","scopedVars","e","console","log","renderMarkdown","renderText","renderingCompleted","templateUrl"],"mappings":"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","file":"echarts_ctrl.js","sourcesContent":["import {\n\tMetricsPanelCtrl\n} from 'app/plugins/sdk';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport $ from 'jquery';\n\nvar panelDefaults = {\n\tremarkable: 'any',\n\tcontent: 'string',\n\tmode: \"text\", // 'html', 'markdown', 'text'\n\tcontent: \"输入描述\"\n};\nexport class TextPanelCtrl extends MetricsPanelCtrl {\n\tconstructor($scope, $injector, templateSrv, $sce) {\n\t\tsuper($scope, $injector);\n\t\tthis.templateSrv = templateSrv;\n\t\tthis.$sce = $sce;\n\n\t\t_.defaults(this.panel, panelDefaults); //将panelDefaults属性附加到this.panel上\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', 'public/app/plugins/panel/oge_text/editor.html', 2);\n\t}\n\n\tonDataReceived(dataList) {\n\t\tthis.data = dataList;\n\t\tthis.HandlingText();\n\t\tthis.render();\n\t}\n\tHandlingText() {\n\t\tif (this.data.content == null && this.data.type == null) {\n\t\t\treturn\n\t\t} else {\n\t\t\tvar describe = this.data.content;\n\t\t\tthis.panel.content = describe;\n\t\t\tif (this.data.type == 1) {\n\t\t\t\tthis.panel.mode = 'html'\n\t\t\t} else if (this.data.type == 2) {\n\t\t\t\tthis.panel.mode = 'markdown'\n\t\t\t} else if (this.data.type == 3) {\n\t\t\t\tthis.panel.mode = 'text'\n\t\t\t}\n\t\t}\n\t}\n\n\trenderText(content) {\n\t\tcontent = content\n\t\t\t.replace(/&/g, '&amp;')\n\t\t\t.replace(/>/g, '&gt;')\n\t\t\t.replace(/</g, '&lt;')\n\t\t\t.replace(/\\n/g, '<br/>');\n\t\tthis.updateContent(content);\n\t}\n\n\trenderMarkdown(content) {\n\t\tif (!this.remarkable) {\n\t\t\treturn System.import('remarkable').then(Remarkable => {\n\t\t\t\tthis.remarkable = new Remarkable();\n\t\t\t\tthis.$scope.$apply(() => {\n\t\t\t\t\tthis.updateContent(this.remarkable.render(content));\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.updateContent(this.remarkable.render(content));\n\t}\n\n\tupdateContent(html) {\n\t\ttry {\n\t\t\tthis.content = this.$sce.trustAsHtml(this.templateSrv.replace(html, this.panel.scopedVars));\n\t\t} catch (e) {\n\t\t\tconsole.log('Text panel error: ', e);\n\t\t\tthis.content = this.$sce.trustAsHtml(html);\n\t\t}\n\t}\n\n\tonRender() {\n\t\tif (this.panel.mode === 'markdown') {\n\t\t\tthis.renderMarkdown(this.panel.content);\n\t\t} else if (this.panel.mode === 'html') {\n\t\t\tthis.updateContent(this.panel.content);\n\t\t} else if (this.panel.mode === 'text') {\n\t\t\tthis.renderText(this.panel.content);\n\t\t}\n\t\tthis.renderingCompleted();\n\t}\n}\n\nTextPanelCtrl.templateUrl = 'module.html';"]}